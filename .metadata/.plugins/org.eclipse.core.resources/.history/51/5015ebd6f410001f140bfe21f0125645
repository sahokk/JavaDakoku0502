package sys;

import java.awt.Dialog;

import dakoku.Dakoku;
import dakoku.JcDakoku;
import dakoku.RDakoku;
import db_control.DbControl;
import db_control.JcInfoControl;
import db_control.RInfoControl;
import login.JcLogin;
import login.Login;
import login.RLogin;
import ui_control.MainFrame;
import ui_control.SettingDialog;
import utility.Dakokustate;

public class MainSystem {
	private static Login jcLogin;
	private static Login rLogin;
	private static Dakoku jcDakoku;
	private static Dakoku rDakoku;
	private DbControl jcInfoControl;
	private DbControl rInfoControl;
	private static Dakokustate dakokustate;
	private static SettingDialog sd;

	public MainSystem() {
		jcInfoControl = new JcInfoControl();
		jcLogin = new JcLogin(jcInfoControl);
		jcDakoku = new JcDakoku(jcLogin);

		rInfoControl = new RInfoControl();
		rLogin = new RLogin(rInfoControl);
		rDakoku = new RDakoku(rLogin);

	}

	public void finishDriver() {
		jcLogin.getDriver().close();
		jcLogin.getDriver().quit();
		rLogin.getDriver().close();
		rLogin.getDriver().quit();

	}

	public void doLogin(boolean jc, boolean r) {
		if (jc) {
			jcLogin.login();
		}
		if (r) {
			rLogin.login();
		}

	}

	public String doDakoku(boolean jc, boolean r) {
		String res = "";
//		時間によってステートを変える　出社か退社か
		dakokustate = Dakokustate.OUT;
		if (jc) {
			res += "Jc:" + (jcDakoku.dakoku(dakokustate) ? "打刻完了" : "打刻失敗") + "\n";
		}
		if (r) {
			res += "R:" + (rDakoku.dakoku(dakokustate) ? "打刻完了" : "打刻失敗") + "\n";
		}
		return res;
	}

	public String settingButton(MainFrame frame) {
		sd = new SettingDialog(frame);
		sd.setBounds(100, 100, 500, 200);
		sd.setResizable(false);
		sd.setVisible(true);
		sd.setModalityType(Dialog.ModalityType.APPLICATION_MODAL);
		String str = "";
		if (!sd.isCanceled()) {
			if (sd.getJcLoginIdField().getText() != "" && sd.getJcLoginPassField().getText() != "") {
				str += jcInfoControl.updateInfo(jcLogin, sd.getJcLoginIdField().getText(),
						sd.getJcLoginPassField().getText()) + "\n";
			}
			if (sd.getRLoginIdField().getText() != "" && sd.getRLoginPassField().getText() != "") {
				str += rInfoControl.updateInfo(rLogin, sd.getRLoginIdField().getText(),
						sd.getRLoginPassField().getText()) + "\n";
			}
		}
		return str;
	}

}
